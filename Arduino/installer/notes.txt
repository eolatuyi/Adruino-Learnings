BUILD AND DL Process

# AVR Libc Reference Manual Options for C compiler avr-gcc has options definition
# Compile and assemble but do not link
avr-gcc -Os -DF_CPU=16000000L -mmcu=atmega328p -c -o blink_led.o blink_led.c

#link to create elf file aka application binary
avr-gcc -mmcu=atmega328p blink_led.o -oblink_led.elf

#Convert elf program to srec Application File format
#Extract portions of application binary into an srec file using avr-objcopy
#Extract ROM contents ... remove .eeprom section
avr-objcopy -O srec -R .eeprom blink_led.elf blink_led.s19

#Uploaded from Target
avrdude -F -V -c arduino -p ATMEGA328P -P com1 -b115200 -U flash:r:blink_edit_bak_app.hex:i


#download to target specifying -p <PART #> -c <programmer-id> -F: skip device signature ping
avrdude -F -V -c arduino -p ATMEGA328P -P com1 -b115200 -U flash:w:blink_led.hex:i

#Program Target using homemade tool and bootloader
# 1. Understand code space access... P 34 of DataSheet
- ATmega328/P Re-Progammable FLash memory for code Size: 32K
- Flash segment 16K by 16
    - AVR instructions width: 2 or 4 bytes which imples <16000 / (<8000) 2 / (<4) bytes instructions
- Flash has: BL and Application section for security
    - BOOTSZ fuses cofigures size of each section
    - Flash also has 2 fixed section Read-While-Write(RWW) section and No Read-While-Write (NRWW) section.
- RWWSB- RWW Section Busy bit in SPMCSR resgister will be read as logical 1 when RWW section is blocked for reading
  and must be cleared before RWW section read
- Configure Boot Loader Lock Bits P333
- Boot Reset Fuse (BOOTRST): configure as app reset vector or BL reset vector
- Fill temporary page buffer one word at a time, perform page erase, perform a page write
- Simple Assembly code example for a Boot Loader P. 340
- For Serial Downloading, see P. 360

# 2. Understand communication protocol 

https://code.google.com/archive/p/arduino/wikis/Platforms.wiki

Variables controlling the process of building sketches for the board:

BOARD.build.mcu: the microcontroller on the board (e.g. "atmega328" or "atmega1280").

BOARD.build.f_cpu: the clock speed at which the microcontroller operates (normally "16000000L", or, for an ATmega168 running on its internal clock, "8000000L").

BOARD.build.core: the location of the core to link sketches against when compiling for the board. This may be the name of a folder in the core sub-folder of the platform (e.g. "arduino") or a value of the format platform:core, where platform is the name of the folder of another platform (e.g. the built-in "arduino") and core is a folder in that platform's core folder.
